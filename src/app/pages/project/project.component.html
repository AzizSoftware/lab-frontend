<div class="main-content">
  <div class="container">
    <div class="page-header">
      <h1>Our Projects</h1>
      <p>Explore our active, completed, and upcoming projects</p>
    </div>

    <nav class="navbar">
      <div class="nav-container">
        <a href="#" class="logo">
          <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjYwIiB2aWV3Qm94PSIwIDAgMjAwIDYwIiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPg0KPGcgaWQ9IkxpbXRpYyI+DQo8cmVjdCB4PSIxNSIgeT0iMTUiIHdpZHRoPSI4IiBoZWlnaHQ9IjgiIGZpbGw9IiM5QUZGMDAiLz4NCjxyZWN0IHg9IjI2IiB5PSIxNSIgd2lkdGg9IjgiIGhlaWdodD0iOCIgZmlsbD0iIzlBRkYwMCIvPg0KPHJlY3QgeD0iMTUiIHk9IjI2IiB3aWR0aD0iOCIgaGVpZ2h0PSI4IiBmaWxsPSIjOUFGRjAwIi8+DQo8cmVjdCB4PSIzNyIgeT0iMTUiIHdpZHRoPSI4IiBoZWlnaHQ9IjgiIGZpbGw9IiM5QUZGMDAiLz4NCjxyZWN0IHg9IjM3IiB5PSIzNyIgd2lkdGg9IjgiIGhlaWdodD0iOCIgZmlsbD0iIzlBRkYwMCIvPg0KPHJlY3QgeD0iNDgiIHk9IjI2IiB3aWR0aD0iOCIgaGVpZ2h0PSI4IiBmaWxsPSIjOUFGRjAwIi8+DQo8cmVjdCB4PSI1NCIgeT0iMTUiIHdpZHRoPSI0IiBoZWlnaHQ9IjgiIGZpbGw9IiMwMDAiLz4NCjxyZWN0IHg9IjU0IiB5PSIzNyIgd2lkdGg9IjQiIGhlaWdodD0iOCIgZmlsbD0iIzAwMCIvPg0KPHRleHQgeD0iNzAiIHk9IjQyIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMzAiIGZvbnQtd2VpZ2h0PSJib2xkIiBmaWxsPSIjMzMzIj5saW10aWM8L3RleHQ+DQo8L2c+DQo8L3N2Zz4=" 
               alt="LIMTIC" style="height: 40px; width: auto;">
        </a>
        <ul class="nav-menu">
          <li><a routerLink="/home" class="nav-link" routerLinkActive="active">Home</a></li>
          <li><a routerLink="/event" class="nav-link" routerLinkActive="active">Events</a></li>
          <li><a routerLink="/project" class="nav-link" routerLinkActive="active">Projects</a></li>
          <li><a routerLink="/file" class="nav-link" routerLinkActive="active">Files</a></li>
        </ul>
        <div class="auth-buttons" *ngIf="!isLoggedIn">
          <a routerLink="/signup" class="nav-link" routerLinkActive="active">Sign Up</a>
        </div>
        <div class="auth-buttons" *ngIf="!isLoggedIn">
          <a routerLink="/login" class="nav-link" routerLinkActive="active">Sign In</a>
        </div>
        <div class="auth-buttons" *ngIf="isLoggedIn">
          <a routerLink="/profile" class="nav-link" routerLinkActive="active">Profile</a>
        </div>
        <div class="auth-buttons" *ngIf="isLoggedIn">
          <a (click)="logout()" class="nav-link">Logout</a>
        </div>
      </div>
    </nav>

    <div class="filter-section">
      <div class="search-filters">
        <div class="filter-group">
          <label for="search">Search Projects</label>
          <input
            type="text"
            id="search"
            [(ngModel)]="searchTerm"
            (input)="applyFilters()"
            placeholder="Search by project name, status, or description..."
          />
        </div>
        <div class="filter-group">
          <label for="projectStatus">Status</label>
          <select
            id="projectStatus"
            [(ngModel)]="selectedProjectStatus"
            (change)="applyFilters()"
          >
            <option value="">All Statuses</option>
            <option value="ACTIVE">Active</option>
            <option value="COMPLETED">Completed</option>
            <option value="NOT_STARTED">Not Started</option>
          </select>
        </div>
      </div>
    </div>

    <div class="add-project-container">
      <button *ngIf="isLoggedIn" class="btn-add" (click)="openModal()">+ Add Project</button>
    </div>

    <div class="projects-container">
      <div *ngIf="loading" class="loading-state">Loading projects...</div>
      <div *ngIf="errorMessage" class="error-state">{{ errorMessage }}</div>

      <div class="project-card" *ngFor="let project of filteredProjects">
        <div
          class="project-status"
          [ngClass]="{
            'status-upcoming': project.status === 'NOT_STARTED',
            'status-ongoing': project.status === 'ACTIVE',
            'status-completed': project.status === 'COMPLETED'
          }"
        >
          {{ project.status | titlecase }}
        </div>

        <img src="/project.jpg" alt="{{ project.projectName }}" />

        <div class="project-date">ðŸ“… {{ project.startDate | date: 'mediumDate' }} - {{ project.endDate | date: 'mediumDate' }}</div>

        <div class="project-content">
          <div class="project-title">{{ project.projectName }}</div>
          <div class="project-description">{{ project.description }}</div>

          <div class="project-meta">
            <div class="project-meta-item">
              <span>ðŸ’°</span>
              <span>Budget: ${{ project.budget }}</span>
            </div>
            <div class="project-meta-item">
              <span>ðŸ‘¥</span>
              <span>{{ project.teamMembers?.length || 0 }}/{{ project.maxTeamMembers }} team members ({{ project.availableSpots }} spots left)</span>
            </div>
          </div>

          <div class="project-actions">
            <ng-container [ngSwitch]="project.status">
              <button
                *ngSwitchCase="'NOT_STARTED'"
                class="btn-register"
                (click)="projectAction('Start', project.id!)"
                [disabled]="!project.id || !isLoggedIn"
              >
                Start Project
              </button>
              <button
                *ngSwitchCase="'COMPLETED'"
                class="btn-info"
                (click)="projectAction('Details', project.id!)"
                [disabled]="!project.id"
              >
                View Details
              </button>
              <button
                *ngSwitchDefault
                class="btn-register"
                (click)="projectAction('Join', project.id!)"
                [disabled]="!project.id || !isLoggedIn || project.availableSpots === 0 || isUserEnrolled(project)"
              >
                {{ isUserEnrolled(project) ? 'Already Joined' : 'Join Project' }}
              </button>
            </ng-container>

            <button
              class="btn-info"
              (click)="projectAction('Details', project.id!)"
              [disabled]="!project.id"
            >
              Details
            </button>
            <!--<button
              *ngIf="isLoggedIn"
              class="btn-info"
              (click)="deleteProject(project.id!)"
              [disabled]="!project.id"
            >
              Delete
            </button>-->
          </div>
        </div>
      </div>

      <div
        *ngIf="!loading && !errorMessage && filteredProjects.length === 0"
        class="no-projects-found"
      >
        No projects found matching your criteria.
      </div>
    </div>
  </div>
</div>

<!-- Add Project Modal -->
<div class="modal-overlay" *ngIf="isModalOpen" (click)="closeModal()"></div>
<div class="modal" *ngIf="isModalOpen" (click)="$event.stopPropagation()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Create New Project</h2>
      <button class="close-btn" (click)="closeModal()">&times;</button>
    </div>

    <form (ngSubmit)="onSubmit()" #projectForm="ngForm" class="modal-body">
      <div class="form-group">
        <label for="projectName">Project Name</label>
        <input
          type="text"
          id="projectName"
          [(ngModel)]="newProject.projectName"
          name="projectName"
          placeholder="Enter project name"
          required
          #projectName="ngModel"
          [ngClass]="{'invalid': projectName.invalid && (projectName.dirty || projectName.touched)}"
        />
        <div *ngIf="projectName.invalid && (projectName.dirty || projectName.touched)" class="error-text">
          Project name is required
        </div>
      </div>
      <div class="form-group">
        <label for="projectDescription">Description</label>
        <textarea
          id="projectDescription"
          [(ngModel)]="newProject.description"
          name="description"
          placeholder="Describe the project..."
          required
          #description="ngModel"
          [ngClass]="{'invalid': description.invalid && (description.dirty || description.touched)}"
        ></textarea>
        <div *ngIf="description.invalid && (description.dirty || description.touched)" class="error-text">
          Description is required
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="projectBudget">Budget</label>
          <input
            type="number"
            id="projectBudget"
            [(ngModel)]="newProject.budget"
            name="budget"
            placeholder="Enter budget"
            min="0"
            required
            #budget="ngModel"
            [ngClass]="{'invalid': budget.invalid && (budget.dirty || budget.touched)}"
          />
          <div *ngIf="budget.invalid && (budget.dirty || budget.touched)" class="error-text">
            Budget is required and must be a positive number
          </div>
        </div>
        <div class="form-group">
          <label for="projectMaxTeam">Max Team Members</label>
          <input
            type="number"
            id="projectMaxTeam"
            [(ngModel)]="newProject.maxTeamMembers"
            name="maxTeamMembers"
            placeholder="Max team members"
            min="1"
            required
            #maxTeamMembers="ngModel"
            [ngClass]="{'invalid': maxTeamMembers.invalid && (maxTeamMembers.dirty || maxTeamMembers.touched)}"
          />
          <div *ngIf="maxTeamMembers.invalid && (maxTeamMembers.dirty || maxTeamMembers.touched)" class="error-text">
            Max team members is required and must be at least 1
          </div>
        </div>
      </div>
      <div class="form-group">
        <label for="projectEndDate">End Date</label>
        <input
          type="date"
          id="projectEndDate"
          [(ngModel)]="newProject.endDate"
          name="endDate"
          required
          #endDate="ngModel"
          [ngClass]="{'invalid': endDate.invalid && (endDate.dirty || endDate.touched)}"
        />
        <div *ngIf="endDate.invalid && (endDate.dirty || endDate.touched)" class="error-text">
          End date is required
        </div>
      </div>
      <div class="form-group">
        <label for="projectStatus">Status</label>
        <select
          id="projectStatus"
          [(ngModel)]="newProject.status"
          name="status"
          required
          #status="ngModel"
          [ngClass]="{'invalid': status.invalid && (status.dirty || status.touched)}"
        >
          <option value="ACTIVE">Active</option>
          <option value="NOT_STARTED">Not Started</option>
          <option value="COMPLETED">Completed</option>
        </select>
        <div *ngIf="status.invalid && (status.dirty || status.touched)" class="error-text">
          Status is required
        </div>
      </div>
      <div class="modal-actions">
        <button type="submit" class="btn-save" [disabled]="!projectForm.valid">
          Create Project
        </button>
        <button type="button" class="btn-cancel" (click)="closeModal()">
          Cancel
        </button>
      </div>
    </form>
  </div>
</div>