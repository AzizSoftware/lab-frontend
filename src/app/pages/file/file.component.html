<div class="main-content">
    <div class="container">
        <div class="page-header">
            <h1>Research Files</h1>
            <p>Access and manage academic documents, reports, and research files</p>
        </div>
        <nav class="navbar">
            <div class="nav-container">
                <a routerLink="/home" class="logo" routerLinkActive="active">
                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjYwIiB2aWV3Qm94PSIwIDAgMjAwIDYwIiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPg0KPGcgaWQ9IkxpbXRpYyI+DQo8cmVjdCB4PSIxNSIgeT0iMTUiIHdpZHRoPSI4IiBoZWlnaHQ9IjgiIGZpbGw9IiM5QUZGMDAiLz4NCjxyZWN0IHg9IjI2IiB5PSIxNSIgd2lkdGg9IjgiIGhlaWdodD0iOCIgZmlsbD0iIzlBRkYwMCIvPg0KPHJlY3QgeD0iMTUiIHk9IjI2IiB3aWR0aD0iOCIgaGVpZ2h0PSI4IiBmaWxsPSIjOUFGRjAwIi8+DQo8cmVjdCB4PSIzNyIgeT0iMTUiIHdpZHRoPSI4IiBoZWlnaHQ9IjgiIGZpbGw9IiM5QUZGMDAiLz4NCjxyZWN0IHg9IjM3IiB5PSIzNyIgd2lkdGg9IjgiIGhlaWdodD0iOCIgZmlsbD0iIzlBRkYwMCIvPg0KPHJlY3QgeD0iNDgiIHk9IjI2IiB3aWR0aD0iOCIgaGVpZ2h0PSI4IiBmaWxsPSIjOUFGRjAwIi8+DQo8cmVjdCB4PSI1NCIgeT0iMTUiIHdpZHRoPSI0IiBoZWlnaHQ9IjgiIGZpbGw9IiMwMDAiLz4NCjxyZWN0IHg9IjU0IiB5PSIzNyIgd2lkdGg9IjQiIGhlaWdodD0iOCIgZmlsbD0iIzAwMCIvPg0KPHRleHQgeD0iNzAiIHk9IjQyIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMzAiIGZvbnQtd2VpZ2h0PSJib2xkIiBmaWxsPSIjMzMzIj5saW10aWM8L3RleHQ+DQo8L2c+DQo8L3N2Zz4=" 
                     alt="LIMTIC" style="height: 40px; width: auto;">
                    
                </a>
                <ul class="nav-menu">
                    <li><a routerLink="/home" class="nav-link" routerLinkActive="active">Home</a></li>
                    <li><a routerLink="/event" class="nav-link" routerLinkActive="active">Events</a></li>
                    <li><a routerLink="/project" class="nav-link" routerLinkActive="active">Projects</a></li>
                    <li><a routerLink="/file" class="nav-link" routerLinkActive="active">Files</a></li>
                </ul>
                <div class="auth-buttons" *ngIf="!isLoggedIn">
                    <a routerLink="/signup" class="nav-link" routerLinkActive="active">Sign Up</a>
                </div>
                <div class="auth-buttons" *ngIf="!isLoggedIn">
                    <a routerLink="/login" class="nav-link" routerLinkActive="active">Sign In</a>
                </div>
                <div class="auth-buttons" *ngIf="isLoggedIn">
                    <a routerLink="/profile" class="nav-link" routerLinkActive="active">Profile</a>
                </div>
                <div class="auth-buttons" *ngIf="isLoggedIn">
                    <a (click)="logout()" class="nav-link">Logout</a>
                </div>
            </div>
        </nav>
        <div class="filter-section">
            <div class="search-filters">
                <div class="filter-group">
                    <label for="searchKeyword">Search by Keyword</label>
                    <input type="text" id="searchKeyword" [(ngModel)]="searchKeyword" (keyup)="applyFilters()" placeholder="Search by keyword...">
                </div>
                <div class="filter-group">
                    <label for="searchFileType">Search by Type</label>
                    <select id="searchFileType" [(ngModel)]="selectedFileType" (change)="applyFilters()">
                        <option value="" selected>All Types</option>
                        <option *ngFor="let type of fileTypeOptions" [value]="type">{{ type }}</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="searchAuthor">Search by Author</label>
                    <input type="text" id="searchAuthor" [(ngModel)]="searchAuthor" (keyup)="applyFilters()" placeholder="Search by author...">
                </div>
                <div class="filter-group">
                    <label for="searchRanking">Search by Classification</label>
                    <select id="searchRanking" [(ngModel)]="searchRanking" (change)="applyFilters()">
                        <option value="" selected>All Classifications</option>
                        <option value="Q1">Q1</option>
                        <option value="Q2">Q2</option>
                        <option value="Q3">Q3</option>
                        <option value="Q4">Q4</option>
                        <option value="A*">A*</option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="Not defined">Not defined</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="add-file-container">
            <button class="btn-add btn-add-large" (click)="openModal()">+ Add File</button>
        </div>
        <div class="files-container" id="filesContainer">
            <div *ngIf="loading" class="loading-state">Loading files...</div>
            <div *ngIf="errorMessage" class="error-state">{{ errorMessage }}</div>
            <table class="files-table" *ngIf="!loading && !errorMessage && filteredFiles.length > 0">
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Keywords</th>
                        <th>Authors</th>
                        <th>Publication Date</th>
                        <th>Type</th>
                        <th>Classification</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let file of filteredFiles">
                        <td>{{ file.title }}</td>
                        <td>
                            <span class="file-type" *ngFor="let keyword of file.keywords; let last = last">{{ keyword }}{{ last ? '' : ', ' }}</span>
                        </td>
                        <td>
                            <span *ngFor="let author of file.authors; let last = last">{{ author }}{{ last ? '' : ', ' }}</span>
                        </td>
                        <td>{{ file.publicationDate }}</td>
                        <td>{{ file.fileType }}</td>
                        <td>{{ file.ranking || 'Not defined' }}</td>
                        <td>
                            <div class="file-actions">
                                <button class="btn-info" (click)="fileAction('Download', file.id)">Download</button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <div *ngIf="!loading && !errorMessage && filteredFiles.length === 0" class="no-files-found">
                No files found matching your criteria.
            </div>
        </div>
    </div>
</div>

<!-- Modal Overlay -->
<div class="modal-overlay" *ngIf="isModalOpen" (click)="closeModal()"></div>

<!-- Modal -->
<div class="modal" *ngIf="isModalOpen" (click)="$event.stopPropagation()">
    <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h2>Upload New File</h2>
            <button class="close-btn" (click)="closeModal()">&times;</button>
        </div>
        <form (ngSubmit)="onSubmit()" #fileForm="ngForm" class="modal-body">
            <div class="form-group">
                <label for="fileInput">Select File</label>
                <div class="file-drop-area" (dragover)="onDragOver($event)" (drop)="onFileDrop($event)">
                    <input
                        type="file"
                        id="fileInput"
                        (change)="onFileChange($event)"
                        name="file"
                        required
                    />
                    <p>Drag and drop a file here or click to browse</p>
                    <p *ngIf="selectedFile">{{ selectedFile.name }}</p>
                </div>
            </div>
            <div class="form-group">
                <label for="fileTitle">File Title</label>
                <input
                    type="text"
                    id="fileTitle"
                    [(ngModel)]="newFile.title"
                    name="title"
                    placeholder="Enter file title"
                    required
                />
            </div>
            <div class="form-group">
                <label for="fileKeywords">Keywords (comma-separated)</label>
                <input
                    type="text"
                    id="fileKeywords"
                    [(ngModel)]="keywordsInput"
                    name="keywords"
                    placeholder="Enter keywords (e.g., research, AI, data)"
                    required
                />
            </div>
            <div class="form-group">
                <label for="fileAuthors">Authors (comma-separated)</label>
                <input
                    type="text"
                    id="fileAuthors"
                    [(ngModel)]="authorsInput"
                    name="authors"
                    placeholder="Enter author names (e.g., John Doe, Jane Smith)"
                    required
                />
            </div>
            <div class="form-group">
                <label for="fileType">File Type</label>
                <select
                    id="fileType"
                    [(ngModel)]="selectedFileType"
                    name="fileType"
                    required
                >
                    <option value="" disabled>Select file type</option>
                    <option *ngFor="let type of fileTypeOptions" [value]="type">{{ type }}</option>
                    <option value="custom">Custom</option>
                </select>
                <input
                    *ngIf="selectedFileType === 'custom'"
                    [(ngModel)]="customFileType"
                    name="customFileType"
                    placeholder="Enter custom file type"
                    class="mt-2"
                    required
                />
            </div>
            <div class="form-group">
                <label for="fileAffiliations">Affiliations (comma-separated, optional)</label>
                <input
                    type="text"
                    id="fileAffiliations"
                    [(ngModel)]="affiliationsInput"
                    name="affiliations"
                    placeholder="Enter affiliations (e.g., University X, Lab Y)"
                />
            </div>
            <div class="form-group">
                <label for="filePublicationDate">Publication Date</label>
                <input
                    type="date"
                    id="filePublicationDate"
                    [(ngModel)]="newFile.publicationDate"
                    name="publicationDate"
                    required
                />
            </div>
            <div class="form-group">
                <label for="fileRanking">Classification</label>
                <select
                    id="fileRanking"
                    [(ngModel)]="newFile.ranking"
                    name="ranking"
                >
                    <option value="" disabled>Select classification</option>
                    <option value="Q1">Q1</option>
                    <option value="Q2">Q2</option>
                    <option value="Q3">Q3</option>
                    <option value="Q4">Q4</option>
                    <option value="A*">A*</option>
                    <option value="A">A</option>
                    <option value="B">B</option>
                    <option value="C">C</option>
                    <option value="D">D</option>
                    <option value="Not defined">Not defined</option>
                </select>
            </div>
            <div class="form-group">
                <label for="fileAbstractText">Abstract</label>
                <textarea
                    id="fileAbstractText"
                    [(ngModel)]="newFile.abstractText"
                    name="abstractText"
                    placeholder="Enter abstract text..."
                ></textarea>
            </div>
            <div class="form-group">
                <label for="fileDoi">DOI (Optional)</label>
                <input
                    type="text"
                    id="fileDoi"
                    [(ngModel)]="newFile.doi"
                    name="doi"
                    placeholder="Enter DOI (e.g., 10.1000/xyz123)"
                />
            </div>
            <div class="modal-actions">
                <button
                    type="submit"
                    class="btn-save"
                    [disabled]="!fileForm.valid || !selectedFile"
                >
                    Upload File
                </button>
                <button type="button" class="btn-cancel" (click)="closeModal()">
                    Cancel
                </button>
            </div>
        </form>
    </div>
</div>