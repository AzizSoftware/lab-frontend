<!-- Navbar -->
<nav class="navbar">
  <div class="nav-container">
    <a href="#" class="logo">
      <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjYwIiB2aWV3Qm94PSIwIDAgMjAwIDYwIiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPg0KPGcgaWQ9IkxpbXRpYyI+DQo8cmVjdCB4PSIxNSIgeT0iMTUiIHdpZHRoPSI4IiBoZWlnaHQ9IjgiIGZpbGw9IiM5QUZGMDAiLz4NCjxyZWN0IHg9IjI2IiB5PSIxNSIgd2lkdGg9IjgiIGhlaWdodD0iOCIgZmlsbD0iIzlBRkYwMCIvPg0KPHJlY3QgeD0iMTUiIHk9IjI2IiB3aWR0aD0iOCIgaGVpZ2h0PSI4IiBmaWxsPSIjOUFGRjAwIi8+DQo8cmVjdCB4PSIzNyIgeT0iMTUiIHdpZHRoPSI4IiBoZWlnaHQ9IjgiIGZpbGw9IiM5QUZGMDAiLz4NCjxyZWN0IHg9IjM3IiB5PSIzNyIgd2lkdGg9IjgiIGhlaWdodD0iOCIgZmlsbD0iIzlBRkYwMCIvPg0KPHJlY3QgeD0iNDgiIHk9IjI2IiB3aWR0aD0iOCIgaGVpZ2h0PSI4IiBmaWxsPSIjOUFGRjAwIi8+DQo8cmVjdCB4PSI1NCIgeT0iMTUiIHdpZHRoPSI0IiBoZWlnaHQ9IjgiIGZpbGw9IiMwMDAiLz4NCjxyZWN0IHg9IjU0IiB5PSIzNyIgd2lkdGg9IjQiIGhlaWdodD0iOCIgZmlsbD0iIzAwMCIvPg0KPHRleHQgeD0iNzAiIHk9IjQyIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMzAiIGZvbnQtd2VpZ2h0PSJib2xkIiBmaWxsPSIjMzMzIj5saW10aWM8L3RleHQ+DQo8L2c+DQo8L3N2Zz4=" 
           alt="LIMTIC" style="height: 40px; width: auto;">
    </a>
    <ul class="nav-menu">
      <li><a routerLink="/home" class="nav-link" routerLinkActive="active">Home</a></li>
      <li><a routerLink="/event" class="nav-link" routerLinkActive="active">Events</a></li>
      <li><a routerLink="/project" class="nav-link" routerLinkActive="active">Projects</a></li>
      <li><a routerLink="/file" class="nav-link" routerLinkActive="active">Files</a></li>
    </ul>
    <div class="auth-buttons" *ngIf="!isLoggedIn">
      <a routerLink="/signup" class="nav-link" routerLinkActive="active">Sign Up</a>
    </div>
    <div class="auth-buttons" *ngIf="!isLoggedIn">
      <a routerLink="/login" class="nav-link" routerLinkActive="active">Sign In</a>
    </div>
    <div class="auth-buttons" *ngIf="isLoggedIn">
      <a routerLink="/profile" class="nav-link" routerLinkActive="active">Profile</a>
    </div>
    <div class="auth-buttons" *ngIf="isLoggedIn">
      <a (click)="logout()" class="nav-link">Logout</a>
    </div>
  </div>
</nav>

<!-- Main Content -->
<div class="main-content">
  <div class="container">
    <div *ngIf="isLoading" class="loading-state">
      <div class="spinner"></div>
      Loading profile...
    </div>
    
    <div *ngIf="!isLoading && user" class="profile-content">
      <!-- Header -->
      <div class="page-header">
        <div class="profile-info">
          <div class="profile-photo-container">
            <img *ngIf="profileImageUrl" [src]="profileImageUrl" alt="Profile Photo" class="profile-photo">
            <div *ngIf="!profileImageUrl" class="profile-photo-placeholder">No Photo</div>
          </div>
          <h1>{{ formatUserName(user) }}</h1>
          <p>{{ user.email }}</p>
          <div class="profile-meta">
            <span class="status-badge" [ngStyle]="{'background-color': getUserStatusColor(user.status)}">
              {{ user.status || 'Unknown' }}
            </span>
            <span class="role-badge" [ngStyle]="{'background-color': getUserRoleColor(user.role)}">
              {{ getUserRoleDisplay(user.role) }}
            </span>
          </div>
          <div *ngIf="isOwnProfile" class="profile-actions">
            <button (click)="toggleEditMode()" class="btn-add">
              {{ editMode ? 'Cancel Edit' : 'Edit Profile' }}
            </button>
            <button (click)="togglePhotoUpload()" class="btn-add">
              {{ showPhotoUpload ? 'Cancel Photo Upload' : 'Upload Photo' }}
            </button>
            <button (click)="toggleUploadForm()" class="btn-add">
              {{ showUploadForm ? 'Cancel Document Upload' : 'Upload Document' }}
            </button>
          </div>
        </div>
      </div>

      <!-- Personal Info -->
      <div class="info-card">
        <div class="card-header">
          <h2 class="card-title">Personal Information</h2>
        </div>
        <div class="info-grid">
          <div class="info-item">
            <label>Full Name</label>
            <span>{{ formatUserName(user) || 'Not specified' }}</span>
          </div>
          <div class="info-item">
            <label>Phone</label>
            <span>{{ user.phone || 'Not specified' }}</span>
          </div>
          <div *ngIf="user.linkedInUrl" class="info-item">
            <label>LinkedIn</label>
            <a [href]="user.linkedInUrl" target="_blank" class="linkedin-link">Profile</a>
          </div>
        </div>
      </div>

      <!-- Professional Info -->
      <div class="info-card">
        <div class="card-header">
          <h2 class="card-title">Professional Information</h2>
        </div>
        <div class="info-grid">
          <div class="info-item">
            <label>Grade</label>
            <span>{{ user.grade || 'Not specified' }}</span>
          </div>
          <div class="info-item">
            <label>Institute</label>
            <span>{{ user.institute || 'Not specified' }}</span>
          </div>
          <div class="info-item">
            <label>Last Diploma</label>
            <span>{{ user.lastDiploma || 'Not specified' }}</span>
          </div>
          <div class="info-item">
            <label>Research Area</label>
            <span>{{ user.researchArea || 'Not specified' }}</span>
          </div>
        </div>
      </div>

      <!-- Edit Profile Form -->
      <div *ngIf="editMode && isOwnProfile" class="info-card edit-form">
        <div class="card-header">
          <h2 class="card-title">Edit Profile</h2>
        </div>
        <form [formGroup]="profileForm" (ngSubmit)="onSubmit()">
          <div class="form-grid">
            <div class="form-group">
              <label>First Name</label>
              <input formControlName="firstName" class="form-control" />
              <div *ngIf="profileForm.get('firstName')?.invalid && profileForm.get('firstName')?.touched" class="error-text">
                First name is required and must be at least 2 characters.
              </div>
            </div>
            <div class="form-group">
              <label>Last Name</label>
              <input formControlName="lastName" class="form-control" />
              <div *ngIf="profileForm.get('lastName')?.invalid && profileForm.get('lastName')?.touched" class="error-text">
                Last name is required and must be at least 2 characters.
              </div>
            </div>
            <div class="form-group">
              <label>Phone</label>
              <input formControlName="phone" class="form-control" />
              <div *ngIf="profileForm.get('phone')?.invalid && profileForm.get('phone')?.touched" class="error-text">
                Valid phone number is required.
              </div>
            </div>
            <div class="form-group">
              <label>Grade</label>
              <input formControlName="grade" class="form-control" />
              <div *ngIf="profileForm.get('grade')?.invalid && profileForm.get('grade')?.touched" class="error-text">
                Grade is required.
              </div>
            </div>
            <div class="form-group">
              <label>Institute</label>
              <input formControlName="institute" class="form-control" />
              <div *ngIf="profileForm.get('institute')?.invalid && profileForm.get('institute')?.touched" class="error-text">
                Institute is required and must be at least 3 characters.
              </div>
            </div>
            <div class="form-group">
              <label>Last Diploma</label>
              <input formControlName="lastDiploma" class="form-control" />
              <div *ngIf="profileForm.get('lastDiploma')?.invalid && profileForm.get('lastDiploma')?.touched" class="error-text">
                Last diploma is required.
              </div>
            </div>
            <div class="form-group full-width">
              <label>Research Area</label>
              <textarea formControlName="researchArea" class="form-control"></textarea>
              <div *ngIf="profileForm.get('researchArea')?.invalid && profileForm.get('researchArea')?.touched" class="error-text">
                Research area is required and must be at least 10 characters.
              </div>
            </div>
            <div class="form-group full-width">
              <label>LinkedIn URL (optional)</label>
              <input formControlName="linkedInUrl" class="form-control" />
              <div *ngIf="profileForm.get('linkedInUrl')?.invalid && profileForm.get('linkedInUrl')?.touched" class="error-text">
                Please enter a valid LinkedIn URL.
              </div>
            </div>
          </div>
          <div class="form-actions">
            <button type="button" (click)="cancelEdit()" class="btn-cancel">Cancel</button>
            <button type="submit" [disabled]="profileForm.invalid" class="btn-save">Save</button>
          </div>
        </form>
      </div>

      <!-- Photo Upload Form -->
      <div *ngIf="showPhotoUpload && isOwnProfile" class="info-card">
        <div class="card-header">
          <h2 class="card-title">Upload Profile Photo</h2>
        </div>
        <div class="file-upload-section">
          <label class="file-upload-area" [ngClass]="{'has-file': selectedPhotoFile}">
            <input type="file" accept="image/*" (change)="onPhotoSelect($event)" class="file-input" />
            <div class="upload-content">
              <span class="upload-icon">ðŸ“·</span>
              <span class="upload-placeholder">{{ selectedPhotoFile ? selectedPhotoFile.name : 'Choose or drag an image' }}</span>
            </div>
          </label>
        </div>
      </div>

      <!-- Uploaded Documents -->
      <div *ngIf="user.uploads?.length; else emptyDocuments" class="info-card">
        <div class="card-header">
          <h2 class="card-title">Uploaded Documents</h2>
        </div>
        <div class="documents-list">
          <div *ngFor="let file of user.uploads" class="document-item">
            <div class="doc-info">
              <h3 class="doc-title">{{ file.title || 'Untitled' }}</h3>
              <div class="doc-meta">
                <span class="doc-authors">{{ file.authors?.join(', ') || 'No authors' }}</span>
                <span class="doc-date">{{ file.publicationDate || 'No date' }}</span>
                <span class="file-type">{{ file.fileType || 'Unknown' }}</span>
              </div>
              <p class="doc-abstract">{{ file.abstractText || 'No abstract' }}</p>
              <div class="doc-tags">
                <span *ngFor="let keyword of file.keywords || []" class="tag">{{ keyword }}</span>
              </div>
            </div>
            <div class="doc-actions">
              <button *ngIf="file.filename" (click)="downloadFile(file)" class="btn-download">Download</button>
            </div>
          </div>
        </div>
      </div>
      <ng-template #emptyDocuments>
        <div class="empty-state">
          <span class="empty-icon">ðŸ“‚</span>
          <p>No documents uploaded yet.</p>
        </div>
      </ng-template>

      <!-- Enrolled Events -->
      <div *ngIf="enrolledEvents?.length; else emptyEvents" class="projects-container">
        <div class="card-header">
          <h2 class="card-title">Enrolled Events</h2>
        </div>
        <div class="project-card" *ngFor="let event of enrolledEvents">
          <img *ngIf="event.image" [src]="event.image" alt="{{ event.eventName }}">
          <div class="project-status status-{{ event.status.toLowerCase() }}">{{ event.status }}</div>
          <div class="project-date">{{ event.startDate | date:'mediumDate' }} - {{ event.endDate | date:'mediumDate' }}</div>
          <div class="project-content">
            <h3 class="project-title">{{ event.eventName }}</h3>
            <p class="project-description">{{ event.description }}</p>
            <div class="project-meta">
              <div class="project-meta-item">
                <span>Location:</span>
                <span>{{ event.location }}</span>
              </div>
              <div class="project-meta-item">
                <span>Participants:</span>
                <span>{{ event.availablePlaces }} / {{ event.maxParticipants }}</span>
              </div>
              <div class="project-meta-item">
                <span>Budget:</span>
                <span>{{ event.budget | currency }}</span>
              </div>
            </div>
            <div class="project-actions">
              <a [routerLink]="['/event', event.id]" class="btn-info">View Details</a>
            </div>
          </div>
        </div>
      </div>
      <ng-template #emptyEvents>
        <div class="empty-state">
          <span class="empty-icon">ðŸŽ‰</span>
          <p>No enrolled events yet.</p>
        </div>
      </ng-template>

      <!-- Enrolled Projects -->
      <div *ngIf="enrolledProjects?.length; else emptyProjects" class="projects-container">
        <div class="card-header">
          <h2 class="card-title">Enrolled Projects</h2>
        </div>
        <div class="project-card" *ngFor="let project of enrolledProjects">
          <img *ngIf="project.image" [src]="project.image" alt="{{ project.projectName }}">
          <div class="project-status status-{{ project.status.toLowerCase() }}">{{ project.status }}</div>
          <div class="project-date">{{ project.startDate | date:'mediumDate' }} - {{ project.endDate | date:'mediumDate' }}</div>
          <div class="project-content">
            <h3 class="project-title">{{ project.projectName }}</h3>
            <p class="project-description">{{ project.description }}</p>
            <div class="project-meta">
              <div class="project-meta-item">
                <span>Team Members:</span>
                <span>{{ project.availableSpots }} / {{ project.maxTeamMembers }}</span>
              </div>
              <div class="project-meta-item">
                <span>Budget:</span>
                <span>{{ project.budget | currency }}</span>
              </div>
            </div>
            <div class="project-actions">
              <a [routerLink]="['/project', project.id]" class="btn-info">View Details</a>
            </div>
          </div>
        </div>
      </div>
      <ng-template #emptyProjects>
        <div class="empty-state">
          <span class="empty-icon">ðŸ“Š</span>
          <p>No enrolled projects yet.</p>
        </div>
      </ng-template>
    </div>
  </div>
</div>